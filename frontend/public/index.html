<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Passkeys Demo: Index</title>
        <link href="/style.css" rel="stylesheet" />
    </head>
    <body hidden>
        <p>Welcome, please select the relevant option:</p>
        <ul id="notLoggedInItems">
            <li><a href="/signUp.html">Sign Up</a></li>
            <li><a href="/signIn.html">Sign In</a></li>
        </ul>
        <ul id="loggedInItems">
            <li><a href="/account.html">My Profile</a></li>
            <li><a id="logoutLink" href="#">Logout</a></li>
        </ul>
    </body>
    <script type="module">
        function toggleItems(isLoggedIn) {
            document.getElementById('notLoggedInItems').hidden = isLoggedIn;
            document.getElementById('loggedInItems').hidden = !isLoggedIn;
        }

        async function logout() {
            const response = await fetch('/api/logout');
            if (response.ok) {
                toggleItems(false);
            } else {
                console.error('Logout failed!');
            }
        }

        async function initPage() {
            const response = await fetch('/api/session');
            if (response.ok) {
                const json = await response.json();
                toggleItems(!!json.userId);
            } else {
                console.error('Failed to get session!');
                toggleItems(false);
            }

            document.getElementById('logoutLink').addEventListener('click', logout);

            document.body.hidden = false;
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPage);
        } else {
            initPage();
        }
    </script>
</html>
